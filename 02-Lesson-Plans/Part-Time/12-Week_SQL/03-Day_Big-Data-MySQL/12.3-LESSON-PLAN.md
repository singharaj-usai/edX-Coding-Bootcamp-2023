# 12.3 Weekday Lesson Plan: Big Data

## Overview

Today's lesson will delve further into SQL queries. You will introduce students to prepared statements, aggregate functions, and joins. Students will also collaborate on a mini-project that reinforces SQL concepts as they build a command-line application that incorporates a SQL database with an Express.js server.

## Instructor Notes

* In this lesson, students will complete activities `21-Ins_Prepared-Statements` through `28-Stu_Mini-Project`.

* In the Stoke Curiosity section, you will use a  sample MySQL database to demonstrate the real-world application of SQL. Before class, visit the [MySQL Employees sample database page](https://dev.mysql.com/doc/employee/en/), then download it and unzip the file. You can also download it directly from the [GitHub repo for the Employees sample database](https://github.com/datacharmer/test_db).

* Make sure that students can initialize the MySQL command-line prompt using the command `mysql -u root -p`. They will need their MySQL password. Students should be encouraged to use a password that is not used for any other personal accounts.

   * If Mac users get a `command not found` error, set up a `.zshrc` file in your home directory and add the `mysql` command to it. To do this, navigate to the home directory and type the following command in the command line: `echo 'export PATH="/usr/local/mysql/bin:$PATH"' >> ~/.zshrc`. Mac users who install using Homebrew should not face this issue. Refer to [MySQL Installation Guide](https://coding-boot-camp.github.io/full-stack/mysql/mysql-installation-guide) for installation instructions.

  * If Windows users get a `command not found` error, refer them to the [MySQL documentation on customizing the PATH](https://dev.mysql.com/doc/mysql-windows-excerpt/5.7/en/mysql-installation-windows-path.html).

* For the activities that use an Express.js server, you will be required to pass your username and SQL password as a parameter of `createConnection()`. Make sure to change the provided user -- if you are not using the default `root` -- and add your personal SQL password before running each demo or activity. The changes will need to be made in the `server.js` file.

* **Important**: You will be demonstrating with a file that contains your database credentials. Be sure that your MySQL password is not used for any other personal accounts, because it will be visible during the demonstrations.

* Remind students to do a `git pull` of the class repo to have today's activities ready and open in VS Code.

* If you are comfortable doing so, live-code the solutions to the activities. If not, just use the solutions provided and follow the prompts and talking points for review.

* Let students know that the Bonus at the end of each activity is not meant to be extra coding practice, but instead is a self-study on topics beyond the scope of this module for those who want to further their knowledge.

* If the students struggle with the `Everyone Do: Git` activity, walk through it with the students using the talking points provided. Otherwise, support the students as they do the activity and do a brief review at the end.

## Learning Objectives

By the end of class, students will be able to:

* Write a SQL query that joins two tables together.

* Implement `?` prepared statements in conjunction with `INSERT`, `UPDATE`, and `DELETE`.

* Perform a calculation on a set of values using aggregate functions.

## Time Tracker

| Start | #   | Activity Name                          | Duration |
| ----- | --- | -------------------------------------- | -------- |
| 0:00  | 1   | Instructor Do: Stoke Curiosity         | 0:05     |
| 0:05  | 2   | Instructor Demo: Prepared Statements   | 0:05     |
| 0:10  | 3   | Student Do: Prepared Statements        | 0:15     |
| 0:25  | 4   | Instructor Review: Prepared Statements | 0:10     |
| 0:35  | 5   | Instructor Demo: Aggregate Functions   | 0:05     |
| 0:40  | 6   | Student Do: Aggregate Functions        | 0:15     |
| 0:55  | 7   | Instructor Review: Aggregate Functions | 0:10     |
| 1:05  | 8   | Instructor Demo:  Join                 | 0:05     |
| 1:10  | 9   | Student Do: Join                       | 0:15     |
| 1:25  | 10  | BREAK                                  | 0:10     |
| 1:35  | 11  | Instructor Review: Join                | 0:10     |
| 1:45  | 12  | Everyone Do: Git                       | 0:10     |
| 1:55  | 13  | Instructor Demo: Mini Project          | 0:05     |
| 2:00  | 14  | Student Do: Mini Project               | 0:45     |
| 2:45  | 15  | Instructor Review: Mini Project        | 0:10     |
| 2:55  | 16  | Introduce Challenge                    | 0:05     |
| 3:00  | 17  | END                                    | 0:00     |

---

## Class Instruction

### 1. Instructor Do: Stoke Curiosity (5 min)

* Welcome students to class.

* If you have not yet downloaded the sample database, download it from the [MySQL Employees sample database page](https://dev.mysql.com/doc/employee/en/employees-installation.html) and unzip the file. You can also download it directly from the [GitHub repo for the Employees sample database](https://github.com/datacharmer/test_db).

* Congratulate the students! At this point, they have learned the basic tools needed to design a relational SQL database that can handle large amounts of data.

* Note, however, that designing a database is just the beginning. SQL developers must also be able to manipulate large amounts of data to answer real-world questions.

* Emphasize that database queries start with a plain-language question that can be solved using the data and the SQL query language.

* Open the `test_db/` directory in your command line to demonstrate the following:

  * Imagine that, on the job, we want to know the first and last names of all employees born in March. To answer this question, we have to find a way to query a database that contains thousands of records to get the results that we need -- and only those results.

  * We start by opening MySQL Shell:

    ```bash
    mysql -u root -p
    ```

  * Next, we import the schema and check that the `employees` database is in use:

    ```sql
    SOURCE employees.sql;
    SELECT DATABASE();
    ```

  * Now let's look at the tables to determine which table is likely to hold the data we need.  We use the `SHOW` command to display the tables, then the `DESCRIBE` command to display the columns used in the `employees` table:

    ```sql
    SHOW TABLES;
    DESCRIBE employees;
    ```

  * The `employees` table has a column for `birth_date` (with a data type of `DATE`), as well as columns for both the employee's first and last name. Querying this table should get us answers.

  * We start writing the query by using `SELECT` to select the columns we want to use from the table. Because we need the names of the employees, we include the `first_name` and `last_name` columns as well as the `birth_date` column:

    ```sql
    SELECT first_name, last_name, birth_date FROM employees
    ```

  * Next, we add a `WHERE` clause to include only the employees who have a birthday in March. The `DATE` data type includes a handy `MONTH()` method that makes it easy to select by month:

    ```sql
    WHERE MONTH(birth_date) = 3
    ```

  * Because this is a big company, thousands of employees might have a birthday in March. So before we test whether the query gets us the answers we need, we will want to limit the results to just a small sample. We can do that by using `LIMIT`:

    ```sql
    LIMIT 25;
    ```

  * When we enter the test query into MySQL Shell, it returns the information we need -- a list of the first and last names of 25 employees born in March. Now we can remove the limit, to return a list that includes all employees with a birthday in March:

    ```sql
    SELECT first_name, last_name, birth_date FROM employees WHERE MONTH(birth_date) = 3 Limit 25;
    ```

  * SQL developers must frequently answer questions -- both mundane and complex -- with data. During today's class, we will focus on ways to access large amounts of data to answer such questions. Then we will apply these skills by building and querying a database.

### 2. Instructor Demo: Prepared Statement (5 min)

* Navigate to `21-Ins_Prepared-Statements/db` in your command line and enter `mysql -u root -p` to start MySQL Shell and demonstrate the following:

  * We create the database using the schema file, then seed the data:

    ```sh
    SOURCE schema.sql;
    SOURCE seeds.sql;
    ```

* Exit the MySQL Shell and run `npm install` and `node server.js` to demonstrate the following:

  * 🔑 We can execute a query directly in the Express.js server to delete a single row from the table.

* Open `21-Ins_Prepared-Statements/server.js` in your IDE and explain the following:

  * 🔑 To delete a single row, we use the `DELETE` command with a `WHERE` clause:

    ```sql
    DELETE FROM course_names WHERE id = 3;
    ```

  * 🔑 Hardcoding works if we only want to delete a particular row. But to make the query more durable, we can use a prepared statement.

  * 🔑 A **prepared statement** is a parameterized query that uses a `?` as a placeholder for the value of the id:

    ```sql
    DELETE FROM books WHERE id = ?
    ```

  * 🔑 For the `DELETE` command to work, we provide the value of the id as the second parameter of the `query()` function:

    ```js
    db.query(`DELETE FROM course_names WHERE id = ?`, 3, (err, result) => {
      if (err) {
        console.log(err);
      }
      console.log(result);
    });
    ```

  * When the query is executed, that value will be inserted into the query (in place of the `?`), and the row with the `id` of `3` will be removed.

* Ask the class the following questions (☝️) and call on students for the answers (🙋):

  * ☝️ Why use a prepared statement?

  * 🙋 A prepared statement allows us to make queries more durable. Instead of hardcoding a value, we can use a `?` placeholder and then provide a value to be inserted as a parameter to the `query()` function. This way we can use a single query to handle multiple points of data, just by reassigning the `?`.

    Prepared statements also make code safer by preventing SQL injection, a vulnerability that allows an attacker to interfere with queries to a database and gain access to data.

* Answer any questions before proceeding to the next activity.

* In preparation for the activity, ask TAs to start directing students to the activity instructions found in `22-Stu_Prepared_Statements/README.md`.

### 3. Student Do: Prepared Statements (15 min)

* Direct students to the activity instructions found in `22-Stu_Prepared_Statements/README.md`.

* Break your students into pairs that will work together on this activity.

  ```md
  # 🐛 Query Not Deleting Row from Table

  Work with a partner to resolve the following issue(s):

  * As a developer, I want to be able to delete a specific row from the `favorite_books` table.

  ## Expected Behavior

  When I run `server.js`, the row with the `id` of `2` should be deleted from the table and the updated table displayed in the console.

  ## Actual Behavior

  When I run `server.js`, an `ER_PARSE_ERROR` error is returned and the table is not updated.

  ## Steps to Reproduce the Problem

  1. In MySQL Shell, execute the `db/schema.sql` file.

  2. Next, execute the `db/seeds.sql` file.

  3. Run `node server.js` to start the Express.js server. The results of the query and the table are shown in the console.

  ## Assets

  The following image demonstrates the web application's appearance and functionality:

  ![A successful console log displays results for id values of 1 through 7, but the row with the id of 2 has been deleted.](./assets/image_1.png)

  ---

  ## 💡 Hints

  What does the `?` represent in a prepared statement?

  ## 🏆 Bonus

  If you have completed this activity, work through the following challenge with your partner to further your knowledge:

  * How can you set user-defined values using a MySQL statement?

  Use [Google](https://www.google.com) or another search engine to research this.
  ```

* While breaking everyone into groups, be sure to remind students and the rest of the instructional staff that questions on Slack or otherwise are welcome and will be handled. It's a good way for your team to prioritize students who need extra help.

### 4. Instructor Review: Prepared Statements (10 min)

* Ask the class the following questions (☝️) and call on students for the answers (🙋):

  * ☝️ How comfortable do you feel with prepared statements? (Poll via Fist to Five, Slack, or Zoom)

* Assure students that we will cover the solution to help solidify their understanding. If questions remain, remind them to use office hours to get extra help!

* Use the prompts and talking points (🔑) below to review the following key points:

  * ✔️ Prepared statements

* Open `22-Stu_Prepared-Statements/Solved/server.js` in your IDE and explain the following:

  * 🔑 We use a prepared statement to insert a parameter (represented by a `?` placeholder) into the query:

    ```sql
    DELETE FROM favorite_books WHERE id = ?
    ```

  * 🔑 To execute the `DELETE` command, we must supply the prepared statement with a value. We assign the `deletedRow` variable a value of `2`:

    ```js
    let deletedRow = 2;
    ```

  * 🔑 To execute the query, we add the variable name as the second argument for the query function. This will set the `id` equal to `2` when the query is executed:

    ```js
    db.query(`DELETE FROM favorite_books WHERE id = ?`, deletedRow, (err, result) => {
      if (err) {
        console.log(err);
      }
     console.log(result);
    });
    ```

* Navigate to `22-Stu_Prepared-Statements/Solved/db` in your command line and enter `mysql -u root -p` to start MySQL Shell and demonstrate the following:

  * We create the database using the schema file, then seed the data:

    ```sh
    SOURCE schema.sql;
    SOURCE seeds.sql;
    ```

* Exit the MySQL Shell and navigate to `22-Stu_Prepared-Statements/Solved/`. Run `npm install` and `node server.js` to demonstrate the following:

  * Now that we have added the variable name as the second argument, when the query function is executed, the row with the `id` of `2` is deleted.

* Ask the class the following questions (☝️) and call on students for the answers (🙋):

  * ☝️ What does the question mark represent in a prepared statement?

  * 🙋 The question mark is a placeholder for a value in a query. For the query to execute, a value must be provided.

  * ☝️ What can we do if we don't completely understand this?

  * 🙋 We can refer to supplemental material, read the [MySQL documentation on prepared statements](https://dev.mysql.com/doc/refman/8.0/en/sql-prepared-statements.html), and stay for office hours to ask for help.

* Answer any questions before proceeding to the next activity.

### 5. Instructor Demo: Aggregate Functions (5 min)

* Navigate to `23-Ins_COUNT-GROUPBY/db` in your command line and enter `mysql -u root -p` to start MySQL Shell and demonstrate the following:

  * For times when we want a quick way to provide summary information about certain data, **aggregate functions** allow us to perform simple calculations.

  * We execute the schema file and seeds to create and populate the database:

    ```sql
    SOURCE schema.sql;
    SOURCE seeds.sql;
    ```

  * We select all from the `course_names` table to check that the tables are populated and view the data:

    ```sql
    SELECT * FROM course_names;
    ```

  * Aggregate functions enable us to view a summary of the data in a table. Using an aggregate function in a query, we can find the total count and sum of a column. To run these queries, we execute the `queries.sql` file:

    ```sql
    SOURCE queries.sql;
    ```

* Open `23-Ins_COUNT-GROUPBY/db/queries.sql` in your IDE and demonstrate the following:

  * Let's look at the query we just ran in the MySQL Shell. To select all from the `course_names` table, we use `SELECT *`:

    ```sql
    SELECT *
    FROM course_names;
    ```

  * We can count the numbers of something in a group of data by adding the `GROUP BY` clause. In this case, doing so will provide the total count of courses for each department:

    ```sql
    SELECT department, COUNT(id) AS number_courses
    FROM course_names
    GROUP BY department;
    ```

  * To return the sum of a column of numbers, we use the aggregate function `SUM()`. When calculating the total, `SUM()` ignores `null` values:

    ```sql
    SELECT department, SUM(total_enrolled) AS sum_enrolled
    FROM course_names
    GROUP BY department;
    ```

* Ask the class the following questions (☝️) and call on students for the answers (🙋):

  * ☝️ What information can aggregate functions provide?

  * 🙋 Aggregate functions can provide summary data for an entire table or for a group of data from the table.

* Answer any questions before proceeding to the next activity.

* In preparation for the activity, ask TAs to start directing students to the activity instructions found in `24-Stu_COUNT-GROUPBY/README.md`.

### 6. Student Do: Aggregate Functions (15 min)

* Direct students to the activity instructions found in `24-Stu_COUNT-GROUPBY/README.md`.

* Break your students into pairs that will work together on this activity.

  ```md
  # 📐 Add Comments to Implementation of Aggregate Functions in MySQL Queries

  Work with a partner to add comments describing the functionality of the code found in [server](./Unsolved/server.js).

  ## 📝 Notes

  Refer to the documentation:

  [MySQL documentation on aggregate functions](https://dev.mysql.com/doc/refman/8.0/en/aggregate-functions.html)

  ---

  ## 🏆 Bonus

  If you have completed this activity, work through the following challenge with your partner to further your knowledge:

  * What other aggregate functions can we use in MySQL queries?

  Use [Google](https://www.google.com) or another search engine to research this.
  ```

* While breaking everyone into groups, be sure to remind students and the rest of the instructional staff that questions on Slack or otherwise are welcome and will be handled. It's a good way for your team to prioritize students who need extra help.

### 7. Instructor Review: Aggregate Functions (10 min)

* Ask the class the following questions (☝️) and call on students for the answers (🙋):

  * ☝️ How comfortable do you feel with aggregate functions? (Poll via Fist to Five, Slack, or Zoom)

* Assure students that we will cover the solution to help solidify their understanding. If questions remain, remind them to use office hours to get extra help!

* Use the prompts and talking points (🔑) below to review the following key points:

  * ✔️ `COUNT()`

  * ✔️ `GROUP BY`

  * ✔️ `SUM()`

* Open `24-Stu_COUNT-GROUPBY/Solved/db/schema.sql` in your IDE and demonstrate the following:

  * The `favorite_books` table has an `id` column that is a primary key. We can use a primary key or another unique identifier to count all the rows in the table:

    ```sql
    id INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    ```

  * The `in_stock` column is a Boolean that returns a value of `true` or `false`. We can use this column to create a grouping of books that are in stock and those that are not:

    ```sql
    in_stock BOOLEAN
    ```

  * The `quantity` column is an integer. We can use that column to get a sum of all of the books:

    ```sql
    quantity INT NOT NULL
    ```

* Open `24-Stu_COUNT-GROUPBY/Solved/server.js` in your IDE and demonstrate the following:

  * 🔑 For a total count of all the rows of the table, we use the aggregate function `COUNT()` to count each `id` value. We use `AS` to provide an alias column name for the counts:

    ```sql
    SELECT COUNT(id) AS total_count
    ```

  * 🔑 Because we want to count the number of books in stock and out of stock, we add `GROUP BY`. This will give us the total count of books with an in-stock value of `true` and the total count of books with an in-stock value of `false`:

    ```sql
    GROUP BY in_stock
    ```

  * 🔑 To count the total books in each department, we use the `SUM()` aggregate function to tally the `quantity` column:

    ```sql
    SUM(quantity)
    ```

  * 🔑 To get the maximum quantity of all books in each department, we use the `MAX()` aggregate function:

    ```sql
    MAX(quantity)
    ```

  * 🔑 To get the minimum quantity of all books in each department, we use the `MIN()` aggregate function:

    ```sql
    MIN(quantity)
    ```

  * 🔑 To get the average quantity of all books in each department, we use the `AVG()` aggregate function:

    ```sql
    AVG(quantity)
    ```

  * To execute the queries inside the Express.js server, we call the `query()` method on the database instance:

    ```sql
    db.query('SELECT COUNT(id) AS total_count FROM favorite_books GROUP BY in_stock', function (err, results) {
      console.log(results);
      });
    ```

* Navigate to `24-Stu_COUNT-GROUPBY/Solved/db` in your command line and enter `mysql -u root -p` to start MySQL Shell and demonstrate the following:

  * To execute the queries, we first execute the schema and seed the data:

    ```sql
    SOURCE schema.sql;
    SOURCE seeds.sql;
    ```

  * We can then exit the shell and navigate to `24-Stu_COUNT-GROUPBY/Solved/`. Enter `npm install` and `node server` to spin up our Express.js server. The results of our queries print to the command line showing the aggregate values.

* Ask the class the following questions (☝️) and call on students for the answers (🙋):

  * ☝️ How can we use aggregate functions to get summary data for the tables?

  * 🙋 We use aggregate functions to operate on sets of values. Aggregate functions include `COUNT()`, `SUM()`, `MIN()`, `MAX()`, and `AVG()`.

  * ☝️ What can we do if we don't completely understand this?

  * 🙋 We can refer to supplemental material, read the [MySQL documentation on aggregate functions](https://dev.mysql.com/doc/refman/8.0/en/aggregate-functions.html), and stay for office hours to ask for help.

* Answer any questions before proceeding to the next activity.

### 8. Instructor Demo: Joins (5 min)

* Navigate to `25-Ins_Join/db` in the command line and demonstrate the following:

  * 🔑 We initialize MySQL Shell and enter the MySQL password. Make sure that MySQL Server is running!

    ```sh
    mysql -u root -p
    ```

  * 🔑 We set up the database and tables:

    ```sql
    SOURCE schema.sql;
    ```

  * 🔑 We seed the database:

    ```sql
    SOURCE seeds.sql;
    ```

  * 🔑 We join the `department` and `course_names` data together by executing the query found in `query.sql`.

    ```sql
    SOURCE query.sql;
    ```

* Navigate to `25-Ins_Join/db/schema.sql` in your IDE and demonstrate the following:

  * We use a primary key to set a unique identifer for each row of data in the `department` table:

    ```sql
    CREATE TABLE department (
      id INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
      name VARCHAR(30) NOT NULL
    );
    ```

  * Then we use a foreign key to establish a relationship. In the `course_names` table, the foreign key `department` will point to the primary key of another table -- in this case the id from the `department` table:

    ```sql
    CREATE TABLE course_names (
      id INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
      name VARCHAR(30) NOT NULL,
      department INT,
      FOREIGN KEY (department)
      REFERENCES department(id)
      ON DELETE SET NULL
    );
    ```

  * This relationship will allow us to join the tables.

* Navigate to `25-Ins_Join/db/query.sql` in your IDE and demonstrate the following:

  * To make a join, we start by selecting data from the `course_names` table:

    ```sql
    SELECT *
    FROM course_names
    ```

  * Then we join the `department` table based on the relationship that we established with the primary and foreign keys:

    ```sql
    JOIN department ON course_names.department = department.id;
    ```

* Ask the class the following questions (☝️) and call on students for the answers (🙋):

  * ☝️ How would we build this?

  * 🙋 First we would use primary and foreign keys to set a relationship between the tables. Then we would write a query that uses the `JOIN` clause.

* Answer any questions before proceeding to the next activity.

* In preparation for the activity, ask TAs to start directing students to the activity instructions found in `26-Stu_Join/README.md`.

### 9. Student Do: Join (15 min)

* Direct students to the activity instructions found in `26-Stu_Join/README.md`.

* Break your students into pairs that will work together on this activity.

  ```md
  # 🏗️ Implement Join Clause to Combine Two Tables

  Work with a partner to implement the following user story:

  * As a developer, I want to create a single table that includes data on book titles and prices.

  ## Acceptance Criteria

  * It's done when the matching values in the `book_prices` and `favorite_books` tables are combined and a new table is returned.

  ## Assets

  The following image demonstrates the web application's appearance and functionality:

  ![The new table includes both book_name and price columns.](./assets/image_1.png)

  ---

  ## 💡 Hints

  What is the relationship between the two tables?

  ## 🏆 Bonus

  If you have completed this activity, work through the following challenge with your partner to further your knowledge:

  * What is a many-to-many relationship?

  Use [Google](https://www.google.com) or another search engine to research this.
  ```

* While breaking everyone into groups, be sure to remind students and the rest of the instructional staff that questions on Slack or otherwise are welcome and will be handled. It's a good way for your team to prioritize students who need extra help.

### 10. BREAK (10 min)

### 11. Instructor Review: JOINS (10 min)

* Ask the class the following questions (☝️) and call on students for the answers (🙋):

  * ☝️ How comfortable do you feel with SQL joins? (Poll via Fist to Five, Slack, or Zoom)

* Assure students that we will cover the solution to help solidify their understanding. If questions remain, remind them to use office hours to get extra help!

* Use the prompts and talking points below to review the following key (🔑) points:

  * ✔️ `SELECT AS`

  * ✔️ `JOIN` clause

  * ✔️ `ON` clause

* Open `26-Stu_Joins/Solved/db/query.sql` in your IDE and explain the following:

  * 🔑 We select the columns that we want to appear in the joined table by using the `SELECT` command. Because we are working with two tables, we use dot notation to enter the name of the table, followed by the name of the column:

    ```sql
    SELECT
    favorite_books.book_name
    ```

  * 🔑 We use the `AS` clause to rename the columns. This alias will appear as the column name at the top of the table:

    ```sql
    SELECT
    favorite_books.book_name AS name, book_prices.price AS price
    ```

  * We use `FROM` to select the `favorite_books` table. The `favorite_books` table references the `book_prices` table with a foreign key:

    ```sql
    FROM favorite_books
    ```

  * 🔑 We then join the `book_prices` table, using the `JOIN` clause:

    ```sql
    JOIN book_prices
    ```

  * 🔑 We use the `ON` clause to show the relationship between the two tables. The schema shows that the `price` column in the new table references the `id` column from the `book_prices` table:

     ```sql
     JOIN book_prices ON favorite_books.book_price = book_prices.id;
     ```

* Ask the class the following questions (☝️) and call on students for the answers (🙋):

  * ☝️ What's the purpose of a `JOIN` clause?

  * 🙋 To combine data from two different but related tables.

  * ☝️ Why is it important to include an `ON` clause?

  * 🙋 The `ON` clause specifies the relationship between the tables that we want to join.

  * ☝️ What can we do if we don't completely understand this?

  * 🙋 We can refer to the lesson plan, read the [MySQL documentation on the JOIN clause](https://dev.mysql.com/doc/refman/5.7/en/join.html), and stay for office hours to ask for help.

* Answer any questions before proceeding to the next activity.

### 12. Everyone Do: Git (10 min)

* Open the [Git Docs on git cherry-pick](https://git-scm.com/docs/git-cherry-pick) in your browser and explain the following:

  * Sometimes you will work on code that has already been fixed or completed in another commit, by another developer. `git cherry-pick` allows you to pull one or multiple commits into your branch.

* Direct students to the activity instructions found in `27-Evr_Git-Cherry-Picking/README.md`.

* While everyone is working on the activity, be sure to remind students and the rest of the instructional staff that questions on Slack or otherwise are welcome and will be handled. It's a good way for your team to prioritize students who need extra help.

* Open your command line and demonstrate the following:

  * When we cherry-pick, we are pulling a particular commit into the branch. To start, let's make a new branch in the repo so that we can pull in a commit:

    ```sh
    git checkout main
    git checkout -b feature/mybranch
    ```

  * 🔑 Now we can make a second branch, which is the branch that we will cherry-pick from:

    ```sh
    git checkout main
    git checkout -b feature/notifications
    ```

  * We open that branch in the IDE and add an `index.html` file:

    ```sh
    <html lang="en">
      <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Git Cherry-Pick!</title>
      </head>
      <body>
       <script src="app.js"></script>
       <code>Git Cherry-Pick 🍒</code>
      </body>
     </html>
    ```

  * We then commit the changes:

    ```sh
    git add -A
    git commit -m "Add index.html file to notifications branch."
    ```

  * Each time we commit a file, we get a hash code. To view the hashes, we can use `git log`.

  * We will use that hash code to cherry-pick the commit. We go back to the branch where we want to pull in the commit:

    ```sh
    git checkout feature/mybranch
    ```

  * While in that branch, we use the `cherry-pick` command plus the hash code:

    ```sh
    git cherry-pick <hash>
    ```

* Answer any questions before proceeding to the next activity.

### 13. Instructor Demo: Mini Project (5 min)

* Open `28-Stu_Mini-Project/Main/db` from the command line and run `mysql -u root` to open MySQL Shell and explain the following:

  * We use the `SOURCE` command to create and seed the database:

    ```sql
    SOURCE schema.sql;
    SOURCE seeds.sql;
    ```

* Exit MySQL Shell and run `npm install` and `node server.js`.

* Navigate to `localhost:3001/api/movie-reviews` in your browser to demonstrate the following:

  * 🔑 When we enter a GET route in the browser, the results of the query are displayed.

  * While we can enter a GET route into the browser, we will need to use Insomnia to test other routes.

* Navigate to Insomnia to demonstrate the following:

  * We select POST and enter `localhost:3001/api/new-movies` to test the route.

  * To add the name of the new movies, we click on JSON and add a new key-pair, making sure we match the column name exactly:

    ```json
    {
      "movie_name": "Hello, World!"
    }
    ```

  * Then we click Send to send the request.

  * To check that the movie has been added, we select a GET route (`localhost:3001/api/movies`) and click Send. If successful, the new movie will be added to the database.

* Ask the class the following questions (☝️) and call on students for the answers (🙋):

  * ☝️ How would we build this?

  * 🙋 First we need to create a database. Then we will use `mysql2` to connect the database to an Express.js server. Finally, we will build routes in Express.js to query the data.

* Answer any questions before allowing students to start the mini project.

### 14. Student Do: Mini Project (45 min)

* Direct students to the activity instructions found in `28-Stu_Mini-Project/README.md`.

* Break your students into groups that will work together on this activity.

  ```md
  # Module 12 Mini Project: Movie Database

  In this mini-project, you will build Rest API routes for creating, retrieving, and deleting movies from a MySQL database.

  ## User Stories

  * As a user, I want to create a new database.

  * As a user, I want to store movie names and reviews in the database in two separate tables.

  * As a user, I want to see a list of all movies.

  * As a user, I want to be able to create and delete a movie.

  * As a user, I want to return a list of all the reviews and the associated movie name.

  ## Acceptance Criteria

  * It's done when `movie_db` is created and contains a `movies` and `reviews` table.

  * It's done when `movie_db` has been seeded with data.

  * It's done when the `/api/movies` route renders a list of all movies.

  * It's done when the `/api/add-movie` route successfully adds a movie when tested using Insomnia.

  * It's done when the `/api/update-review` route successfully updates a movie when tested using Insomnia.

  * It's done when the `/api/movie/:id` route deletes a route when tested using Insomnia.

  ## Assets

  Design the following database schema that contains two tables:

  ![The database schema includes a movies table and a reviews table, linked by the movie id.](./assets/image_1.png)

  ## Notes

  To test your routes you will use Insomnia. If you have not already downloaded it, you will need to visit the [Insomnia download page](https://insomnia.rest/download) and do so.

  Refer to the documentation:

  [Insomnia documentation on getting started](https://support.insomnia.rest/category/152-using-insomnia)

  [Express.js documentation on routing](https://expressjs.com/en/guide/routing.html)

  [MySQL documentation on joins](https://dev.mysql.com/doc/refman/8.0/en/join.html)

  [npm documentation on MySQL2](https://www.npmjs.com/package/mysql2)

  ---

  ## 💡 Hints

  How can you link your `movies` and `reviews` tables?

  How can you execute a query in an Express.js server using the npm `MySQL2` package?

  ## 🏆 Bonus

  If you have completed this activity, work through the following challenge with your partner to further your knowledge:

  * How can you add a route to update a review?

  Use [Google](www.google.com) or another search engine to research this.
  ```

* While breaking everyone into groups, be sure to remind students and the rest of the instructional staff that questions on Slack or otherwise are welcome and will be handled. It's a good way for your team to prioritize students who need extra help.

### 15. Instructor Review: Mini Project (10 min)

* Ask the class the following questions (☝️) and call on students for the answers (🙋):

  * ☝️ How comfortable do you feel with this mini-project? (Poll via Fist to Five, Slack, or Zoom)

* Assure students that we will cover the solution to help solidify their understanding. If questions remain, remind them to use office hours to get extra help!

* Use the prompts and talking points (🔑) below to review the following key points:

  * ✔️ `schema.sql`

  * ✔️ `seeds.sql`

  * ✔️ `createConnection()`

  * ✔️ Query

  * ✔️ `query()`

* Open `28-Stu_Mini-Project/Main/db/schema.sql` in your IDE and explain the following:

  * We start by creating a schema that describes the tables and data we want to store.

  * 🔑 We link the two tables using a foreign key. The foreign key references the `movie_id` column from the `movies` table:

    ```sql
    CREATE TABLE reviews (
      id INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
      movie_id INT,
      review TEXT NOT NULL,
      FOREIGN KEY (movie_id)
      REFERENCES movies(id)
      ON DELETE SET NULL
    );
    ```

* Open `28-Stu_Mini-Project/Main/db/seeds.sql` in your IDE and explain the following:

  * 🔑 We insert data to seed the database using the `INSERT INTO` command:

    ```sql
    INSERT INTO movies (movie_name)
      VALUES ("Lion King"),
        ("The Godfather"),
        ("West Side Story"),
        ("Parasite"),
        ("The Wizard of Oz");

    INSERT INTO reviews (movie_id, review)
      VALUES (1, "Zazu is underrated. Give that hornbill a sequel!"),
        (2, "I'm gonna make him an offer you can't refuse, watch this movie"),
        (1, "Scar is the lion everyone loves to hate"),
        (3, "Ten years of ballet and three years of tap to join a gang in this neighborhood"),
        (5, "The tin man gave a metallic, hollow performance"),
        (1, "Hakuna matata"),
        (5, "Those flying monkeys are nightmare fuel!");
    ```

  * 🔑 To create the routes, we start by writing a query to access the data:

    ```sql
    INSERT INTO movies (movie_name)
    VALUES (?);
    ```

* Open `28-Stu_Mini-Project/Main/server.js` in your IDE and explain the following:

  * We use the Node.js package `mysql2` to connect the database to an Express.js server:

    ```js
    const mysql = require('mysql2');
    ```

  * 🔑 Then we create a connection to the database using `createConnection()`:

    ```js
    const db = mysql.createConnection(
      {
        host: 'localhost',
        user: 'root',
        password: '',
        database: 'movies_db'
      },
      console.log(`Connected to the movies_db database.`)
    );
    ```

  * 🔑 Now that we have a connection, we can query the database directly from the Express.js environment. We use the `query()` method to execute the query on the database:

    ```js
    db.query(sql, params, (err, result) => {
      if (err) {
        res.status(400).json({ error: err.message });
        return;
      }
      res.json({
        message: 'success',
        data: body
      });
    ```

  * 🔑 Finally, we wrap the query in an Express.js route. The paths define the endpoints at which requests can be made. When a route is requested, the query will be executed:

    ```js
    app.post('/api/new-movie', ({ body }, res) => {
      const sql = `INSERT INTO movies (movie_name)
      VALUES (?)`;
      const params = [body.movie_name];

     db.query(sql, params, (err, result) => {
      if (err) {
        res.status(400).json({ error: err.message });
        return;
      }
      res.json({
        message: 'success',
        data: body
      });
      });
     });
    ```

* Ask the class the following questions (☝️) and call on students for the answers (🙋):

  * ☝️ How can we use a route to execute a query in Express.js?

  * 🙋 First we connect the database using `mysql2`. Then we use the `query()` method to execute the query, and we wrap the method in a valid Express.js route.

  * ☝️ What can we do if we don't completely understand this?

  * 🙋 We can refer to supplemental material, read the [Express.js documentation on routing](https://expressjs.com/en/guide/routing.html), and stay for office hours to ask for help.

* Answer any questions before proceeding to the next activity.

### 16. Instructor Demo: Introduce Challenge (5 min)

* Open `12-SQL/02-Challenge/Main/db` from the command line and run `mysql -u root -p` to open MySQL Shell and demonstrate the following.

  * We use the `SOURCE` command to create and seed the database:

    ```sql
    SOURCE schema.sql;
    SOURCE seed.sql;
    ```

* Exit MySQL Shell and run `npm install` and `npm start` to demonstrate the following:

  * From the command line, we can run numerous queries to add, select, and delete employees.

  * We click on View All Employees to select all of the employees.

  * We can also select employees by department or delete an employee. Each time we make a selection, a query is executed on the database and the results are displayed.

  * To complete this project, you will have to design a database that can handle the necessary queries, as well as use your skills to perform queries that rely on one or more tables.

* Ask the class the following questions (☝️) and call on students for the answers (🙋):

  * ☝️ What are we learning?

  * 🙋 We are learning how to build a database, perform queries, and join tables.

  * ☝️ How does this project build off or extend previously learned material?

  * 🙋 To complete this project, we will have to use the skills learned this week, like creating a schema, seeding a database, writing queries, and performing joins.

  * ☝️ How does this project relate to your career goals?

  * 🙋 SQL is an in-demand skill used in many workplaces.

* Ask TAs to direct students to the Challenge Requirements found in `12-SQL/02-Challenge/README.md`.

* Answer any questions before ending the class.

### 17. END (0 min)

How did today’s lesson go? Your feedback is important. Please take 5 minutes to complete this [anonymous survey](https://forms.gle/RfcVyXiMmZQut6aJ6).

---
© 2022 edX Boot Camps LLC. Confidential and Proprietary. All Rights Reserved.
