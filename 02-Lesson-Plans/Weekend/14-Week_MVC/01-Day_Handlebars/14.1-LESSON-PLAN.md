# 14.1 Part-Time Lesson Plan: Model-View-Controller (MVC)

## Overview

In today's class, students will learn about the MVC framework and the separation of concerns. Starting with hardcoded data, they will practice using template engines on the front end by implementing Handlebars.js expressions and built-in helpers. Then they will use Sequelize and MySQL to handle data logic on the back end. In the process, they will learn how the Controller mediates between the View and the Model by processing requests for data, using routes to manipulate the database, and passing serialized data to the View.

## Instructor Notes

* In this lesson, students will complete activities `01-Ins_MVC-Handlebars` through `10-Stu_Handlebars-FE-Logic`.

* This module introduces students to the template engine **Handlebars.js**. Students might not use Handlebars.js in their careers, but learning this tool will help introduce them to template engines, prepare them to work with React.js, and demonstrate the MVC framework.

* You will use MySQL for a few of today's activities, so be sure to have your MySQL server up and running. You can create the `dish_db` database ahead of time, or you can demonstrate it live in class.

* The first several activities, `01-Ins_MVC-Handlebars-Intro` through `06-Stu_Built-In-Helpers`, include hardcoded data in Handlebars.js templates, in `index.html`, or in the `dish-routes.js` file. Every subsequent activity (starting with `07-Ins_Data-Serialization`) includes a seeds folder. Run `node seeds/index.js` before class, or demonstrate seeding the database live in class.

* Starting with `07-Ins_Data-Serialization`, each activity requires a `.env` file. Be sure to create one or rename the existing `.env.EXAMPLE` file before demonstrating each activity.

* Be prepared to remind students how to start their MySQL server and create the `dish_db` database in `08-Stu_Data-Serialization`.

* Remind students to do a `git pull` of the class repo to have today's activities ready and open in VS Code.

* If you are comfortable doing so, live-code the solutions to the activities. If not, just use the solutions provided and follow the prompts and talking points for review.

* Let students know that the Bonus at the end of each activity is not meant to be extra coding practice, but instead is a self-study on topics beyond the scope of this module for those who want to further their knowledge.

## Learning Objectives

By the end of class, students will be able to:

* Implement MVC modularization in a full-stack web application.

* Render dynamic HTML using the Handlebars.js template engine.

* Dynamically pass data to other helpers or components using built-in helpers.

* Simplify objects by using data serialization, to work with necessary properties only.

* Explain the separation of concerns and its benefits.

## Slide Deck

* [Module 14 Slide Deck](https://docs.google.com/presentation/d/1RIA8VZVN4_JAaL0xSPf1GPc8b5dJlM5V43EVNEZ_kfA/edit?usp=sharing)

## Time Tracker

| Start  | #   | Activity Name                                    | Duration |
| ------ | --- | ------------------------------------------------ | -------- |
| 6:30PM | 1   | Instructor Do: Stoke Curiosity                   | 0:10     |
| 6:40PM | 2   | Instructor Demo: MVC Handlebars.js Intro         | 0:05     |
| 6:45PM | 3   | Student Do: MVC Handlebars.js Intro              | 0:15     |
| 7:00PM | 4   | Instructor Review: MVC Handlebars.js Intro       | 0:10     |
| 7:10PM | 5   | Instructor Demo: Handlebars.js Expressions       | 0:05     |
| 7:15PM | 6   | Student Do: Handlebars.js Expressions            | 0:15     |
| 7:30PM | 7   | Instructor Review: Handlebars.js Expressions     | 0:10     |
| 7:40PM | 8   | Instructor Demo: Built-In Helpers                | 0:05     |
| 7:45PM | 9   | Student Do: Built-In Helpers                     | 0:15     |
| 8:00PM | 10  | BREAK                                            | 0:15     |
| 8:15PM | 11  | Instructor Review: Built-In Helpers              | 0:10     |
| 8:25PM | 12  | Instructor Demo: Data Serialization              | 0:05     |
| 8:30PM | 13  | Student Do: Data Serialization                   | 0:15     |
| 8:45PM | 14  | Instructor Review: Data Serialization            | 0:10     |
| 8:55PM | 15  | Instructor Demo: Handlebars.js Front-End Logic   | 0:05     |
| 9:00PM | 16  | Student Do: Handlebars.js Front-End Logic        | 0:15     |
| 9:15PM | 17  | Instructor Review: Handlebars.js Front-End Logic | 0:15     |
| 9:30PM | 18  | END                                              | 0:00     |

---

> **Important**: If this lesson occurs on a Saturday, make sure to adjust the activities to accommodate for the extra hour of class time. Feel free to take your time as you go through the activities; for example, you can add 5 minutes to the `Student Do` and `Instructor Review` sections as you see fit. Remember to take a 40-minute break at noon!

---

## Class Instruction

### 1. Instructor Do: Stoke Curiosity (10 min)

* Welcome students to class.

* Open the [slide deck](https://docs.google.com/presentation/d/1RIA8VZVN4_JAaL0xSPf1GPc8b5dJlM5V43EVNEZ_kfA/edit?usp=sharing) and follow these prompts on their corresponding slides:

  * **MVC**
  
    * This module is all about the MVC architectural pattern, how it follows the separation of concerns principle, and the tools that help us follow this pattern&mdash;like the templating engine Handlebars.js.

  * **What is the separation of concerns principle?**
  
    * **Separation of concerns** is a design principle that each section of a program should address a separate concern.

    * In a restaurant, the chef‚Äôs concern is to cook the food, while the server‚Äôs concern is to take orders and serve food, and a customer‚Äôs concern is to order and eat.

    * We do not expect the customer to go back into the kitchen to cook food or the server to sit at a table and order, etc.

  * **What is MVC?**
  
    * The **Model-View-Controller (MVC)** framework is an architectural pattern that adheres to the separation of concerns principle.

    * The **Model** stores data and data-related logic.

    * The **View** is in charge of UI/UX concerns, or what a user will see and interact with.

    * The **Controller** is the interface between Models and Views. It processes requests from the View, uses the Model to manipulate data, and sends data to the View to render.

  * **What is a template engine?**
  
    * A **template engine** is software that allows us to combine data with a static template to generate dynamic HTML. Most template engines offer the following features:

      * Placeholders for data that we wish to include

      * Functions

      * Conditional rendering and looping

      * Text replacement

  * **What are the advantages of using template engines?**
  
    * They help us follow the separation of concerns principle and MVC by providing an easy, clean way to separate HTML and JavaScript.

    * They offer tools that reduce repetition in code.

    * Templates are easy to create, use, and maintain.

    * They improve SEO and make fewer client-to-server requests.

  * **What is Handlebars.js?**
  
    * **Handlebars.js** is an extension of the templating language Mustache.

    * It is a logicless templating language that separates code from the View.

    * It compiles templates into a single resource and then returns the HTML after replacing variables with data.

    * It is a pure rendering engine&mdash;meaning that it has no built-in support for event handling, accessing back-end services, or making incremental DOM updates.

  * **Why are we learning Handlebars.js?**
  
    * It gives us a great introduction to template engines because it is easy to use but offers a ton of functionality. It isn‚Äôt the only option out there, but it is a great place to start!

    * It prepares us to encounter other languages that have this sort of templating built into them.

    * It helps us follow separation of concerns and the MVC framework.

    * It is a step towards learning to use heavier frameworks like React.js to build single-page applications.
  
  * **How can we learn to use and implement MVC and Handlebars.js?**

    * Handlebars.js and other template engines are designed to make implementing the MVC pattern easier.

    * You can try the following strategies to learn MVC and Handlebars.js:

      * Read the official documentation and practice with the provided examples.

      * Reverse-engineer finished code to see how something was accomplished.

      * Build something from scratch.

      * Debug a broken app.

      * And most importantly, ask questions!

* Navigate to `28-Stu_Mini-Project/Main` in your command line.

* If you haven't already, rename the `.env.EXAMPLE` file and fill in your credentials. Run `seeds/seed.js` to data.

* Run `npm install` and `npm start` in the command line.

* Navigate to <http://localhost:3001/> in your browser and demonstrate the following:

  * The mini-project for this module uses Handlebars.js to build the View for a crowdfunding app.

  * The homepage for the crowdfunding app is rendered using Handlebars.js templates and displays all projects from the database.

* Navigate to <http://localhost:3001/login> in your browser and demonstrate the following:

  * A user can create an account if they don't have one.

  * Log into an account using the credentials `sal@hotmail.com` and `password12345`.
  
* Once logged in, navigate to <http://localhost:3001/profile> in your browser and demonstrate the following:

  * Logged-in users can view their projects when they visit `/profile`.

  * Logged-in users can create and delete projects when they visit `/profile`.

* Click the logout button on the page to demonstrate that a user can log out of their account.

* Ask the class the following questions (‚òùÔ∏è) and call on students for the answers (üôã):

  * ‚òùÔ∏è What are we learning?

  * üôã We are learning the MVC framework, template engines like Handlebars.js, and data serialization.

  * ‚òùÔ∏è How does this project build off or extend previously learned material?

  * üôã For this project, we will need to implement the skills we've already acquired in Sequelize, MySQL, and object-oriented programming. It will also be a true full-stack application, including both a front end and a back end.

  * ‚òùÔ∏è How does this project relate to your career goals?

  * üôã You will be sure to encounter the MVC framework as a professional developer, and template engines like Handlebars.js will help you write HTML content more intuitively (instead of as a string). Finally, all this work will prepare you to use heavier frameworks, like React.js.

* Answer any questions before proceeding to the next activity.

### 2. Instructor Demo: MVC Handlebars.js Intro (5 min)

* Run `npm install` and `npm start` from the command line.

* Open `01-Ins_MVC-Handlebars-Intro/controllers/dish-routes.js` in your IDE and demonstrate the following:

  * üîë The MVC architectural pattern is used in most modern web applications.

  * üîë The MVC framework includes Models, Views, and Controllers. The Controller is the interface between the View and the Model. It processes requests, uses the Model to manipulate data, and sends data to the View to render.

  * `dish-routes.js` currently includes a GET route. Right now, the route tells the View to render `index.html` when the user visits `/`, as follows:

      ```js
         router.get('/', async (req, res) => {
           res.sendFile(path.join(__dirname, '../views/index.html'));
         });
      ```

* Open `01-Ins_MVC-Handlebars-Intro/views/index.html` in your IDE and demonstrate the following:

  * üîë The View is responsible for UI/UX concerns (what a user can view in the browser).

  * For now the dishes are hardcoded in `views/index.html`. But today you will learn how to render data dynamically using Handlebars.js, Sequelize, and MYSQL.

* Navigate to <http://localhost:3001/> in your browser and demonstrate the following:

  * The View in this application shows a menu of dishes that guests plan to bring to a potluck party.

* Open `01-Ins_MVC-Handlebars-Intro/models/Dish.js` in your IDE and demonstrate the following:

  * üîë `Dish.js` is a Model. Models are in charge of data-related logic, like creating a new dish object.

  * We learned how to set up models previously, when we worked with ORMs. Remember, the data is hardcoded in `index.js`, so `Dish.js` is set up, but isn't actually doing anything at the moment.

* Ask the class the following questions (‚òùÔ∏è) and call on students for the answers (üôã):

  * ‚òùÔ∏è What does MVC stand for?

  * üôã MVC stands for Model-View-Controller.

* Answer any questions before proceeding to the next activity.

* In preparation for the activity, ask TAs to start directing students to the activity instructions found in `02-Stu_MVC-Handlebars-Intro/README.md`.

### 3. Student Do: MVC Handlebars.js Intro (15 min)

* Direct students to the activity instructions found in `02-Stu_MVC-Handlebars-Intro/README.md`.

* Break your students into pairs that will work together on this activity.

  ```md
  # üìê Add Comments to Implementation of MVC and Handlebars.js

  Work with a partner to add comments describing the functionality of the code found in [Dish.js](./Unsolved/models/Dish.js), [main.handlebars](./Unsolved/views/layouts/main.handlebars), and [dish-routes.js](./Unsolved/controllers/dish-routes.js).

  ## üìù Notes

  Refer to the documentation: 

  [npm documentation on Express Handlebars](https://www.npmjs.com/package/express-handlebars)

  [MDN Web Docs on MVC](https://developer.mozilla.org/en-US/docs/Glossary/MVC)

  ---

  ## üèÜ Bonus

  If you have completed this activity, work through the following challenge with your partner to further your knowledge:

  * What are some other template engines? 

  Use [Google](https://www.google.com) or another search engine to research this.
  ```

* While breaking everyone into groups, be sure to remind students and the rest of the instructional staff that questions on Slack or otherwise are welcome and will be handled. It's a good way for your team to prioritize students who need extra help.

### 4. Instructor Review: MVC Handlebars.js Intro (10 min)

* Ask the class the following questions (‚òùÔ∏è) and call on students for the answers (üôã):

  * ‚òùÔ∏è How comfortable do you feel with MVC and Handlebars.js? (Poll via Fist to Five, Slack, or Zoom)

* Assure students that we will cover the solution to help solidify their understanding. If questions remain, remind them to use office hours to get extra help!

* Use the prompts and talking points (üîë) below to review the following key points:

  * ‚úîÔ∏è Model

  * ‚úîÔ∏è View

  * ‚úîÔ∏è Controller

  * ‚úîÔ∏è Handlebars.js static templates

* Open `02-Stu_MVC-Handlebars-Intro/Solved/package.json` in your IDE and explain the following:

  * We've added `express-handlebars` as a dependency in `package.json`, so we need to run `npm install`&mdash;as shown in the following example&mdash;to ensure that all the packages are installed before working on the code:

    ```json
    "dependencies": {
      "express": "^4.16.3",
      "express-handlebars": "^3.0.0"
      }
    ```

* Open `02-Stu_MVC-Handlebars-Intro/Solved/server.js` in your IDE and explain the following:

  * We import the `express-handlebars` library in `server.js`, as follows:

    ```js
    const exphbs = require('express-handlebars');
    const hbs = exphbs.create({});
    ```

  * We set Handlebars.js as the default template engine, as shown in the following example:

    ```js
    app.engine('handlebars', hbs.engine);
    app.set('view engine', 'handlebars');  
    ```

* Open `02-Stu_MVC-Handlebars-Intro/Solved/controllers/dish-routes.js` in your IDE and explain the following:

  * üîë `dish-routes.js` is the Controller.

  * As the Controller, `dish-routes.js` interfaces between the View and the Model.

  * Now that we are using Handlebars.js, the GET route directs the View to render `all.handlebars`.

  * The contents of `all.handlebars` will now become `{{{ body }}}` in the main layout, as follows:

      ```js
      router.get('/', async (req, res) => {
        res.render('all');
      });
      ```

* Open `02-Stu_MVC-Handlebars-Intro/Solved/views/layouts/main.handlebars` in your IDE and explain the following:

  * üîë `main.handlebars` is part of the View.
  
  * The file looks like standard HTML, except for `{{{ body}}}`, which is a Handlebars.js placeholder. Whatever the Controller directs the View to render will be plugged into that placeholder, as shown in the following example:

    ```html
        <main class="container container-fluid mt-5">
          {{{ body }}}
        </main>
    ```

* Open `02-Stu_MVC-Handlebars-Intro/Solved/views/all.handlebars` in your IDE and explain the following:

  * üîë `all.handlebars` is also part of the View. Currently, we are rendering hardcoded data.

* Open `02-Stu_MVC-Handlebars-Intro/Solved/models/Dish.js` in your IDE and explain the following:

  * üîë `Dish.js` is a Model. But it is not actually doing anything yet, because we are rendering hardcoded data.

* Ask the class the following questions (‚òùÔ∏è) and call on students for the answers (üôã):

  * ‚òùÔ∏è What is the `{{{ body }}}` syntax?

  * üôã It is a Handlebars.js placeholder.

  * ‚òùÔ∏è How does the View know what to plug into `{{{ body }}}`?

  * üôã The routes in the Controller will indicate which template to render.

  * ‚òùÔ∏è For now we are hardcoding the data, but where would the Controller typically get data to pass to the View?

  * üôã The Model is in charge of the data logic, so normally the Controller would retrieve and manipulate data using the Model.

  * ‚òùÔ∏è What can we do if we don't completely understand this?

  * üôã We can refer to supplemental material, read the [Handlebars.js documentation](https://handlebarsjs.com/guide/#what-is-handlebars), and stick around for office hours to ask for help.

* Answer any questions before proceeding to the next activity.

### 5. Instructor Demo: Handlebars.js Expressions (5 min)

* Open `03-Ins_Handlebars-Expressions/controllers/dish-routes.js` in your IDE and demonstrate the following:

  * In the previous activity, we hardcoded data in the View. Now we are beginning to pass static data (an array of objects called `dish`) to the View in the Controller.

  * Each object includes a `dish_name` and `description` key-value pair, like in the following example:

    ```js
      {
        dish_name: 'French Bread with Brie Cheese',
        description: 'French baguette with warm brie',
      },
    ```

  * The Controller includes a GET route that passes the static data for one dish into a Handlebars.js template, as follows:

    ```js
     router.get('/dish/:num', async (req, res) => {
      return res.render('dish', dishes[req.params.num - 1]);
     });
    ```

* Navigate to `03-Ins_Handlebars-Expressions/views/dish.handlebars` in your IDE and demonstrate the following:

  * üîë The template for one dish uses a Handlebars.js expression to render the dish name. Inside the double curly brackets, we include the `dish_name` key so that its value will be rendered&mdash;as shown in the following example:

    ```html
      <div class="dish-card">
        <div class="dish-card-header">
          {{dish_name}}
        </div>
      </div>
    ```

* Run `npm install` and `npm start` from the command line.

* Navigate to <http://local:host3001/dish/1> and demonstrate the following:

  * üîë When we view the page for one dish now, we see the name of that dish.

* Navigate to <http://local:host3001/dish/2> and demonstrate the following:

  * üîë And when we view the page for another dish, we see that the template is the same, but the data has changed.

* Ask the class the following questions (‚òùÔ∏è) and call on students for the answers (üôã):

  * ‚òùÔ∏è How would we build this?

  * üôã We would insert the key of the value we wish to render into a Handlebars.js expression in the correct template.

* Answer any questions before proceeding to the next activity.

* In preparation for the activity, ask TAs to start directing students to the activity instructions found in `04-Stu_Handlebars-Expressions/README.md`.

### 6. Student Do: Handlebars.js Expressions (15 min)

* Direct students to the activity instructions found in `04-Stu_Handlebars-Expressions/README.md`.

* Break your students into pairs that will work together on this activity.

  ```md
  # üèóÔ∏è Implement a GET Route for Food Item Descriptions 

  Work with a partner to implement the following user story:

  * As a party guest, I want to see a description of one food item that will be at the potluck when I visit <http://localhost:3001/dish/:num>.

  ## Acceptance Criteria

  * It's done when the route called `/dish/:num` is properly configured to retrieve and return a food item and its description.

  * It's done when the view displays a description for the food item, where the list number matches the route `/dish/:num`.

  ## Assets

  The following image demonstrates the web application's appearance and functionality:

  ![A webpage with the header "Potluck Party!" displays the name and description for a Pork Gyoza dish.](images/dish-description.png)

  ---

  ## üí° Hints

  How can you ensure that the correct Handlebars.js template is rendered?

  ## üèÜ Bonus

  If you have completed this activity, work through the following challenge with your partner to further your knowledge:

  * How can we render an array of objects using Handlebars.js?

  Use [Google](https://www.google.com) or another search engine to research this.
  ```

* While breaking everyone into groups, be sure to remind students and the rest of the instructional staff that questions on Slack or otherwise are welcome and will be handled. It's a good way for your team to prioritize students who need extra help.

### 7. Instructor Review: Handlebars.js Expressions (10 min)

* Ask the class the following questions (‚òùÔ∏è) and call on students for the answers (üôã):

  * ‚òùÔ∏è How comfortable do you feel with Handlebars.js expressions? (Poll via Fist to Five, Slack, or Zoom)

* Assure students that we will cover the solution to help solidify their understanding. If questions remain, remind them to use office hours to get extra help!

* Use the prompts and talking points (üîë) below to review the following key points:

  * ‚úîÔ∏è GET route for `/dish/:num`

  * ‚úîÔ∏è Handlebars.js expressions

* Open `04-Stu_Handlebars-Expressions/Solved/controllers/dish-routes.js` in your IDE and explain the following:

  * üîë To render a description for a dish, we first need to build a route for `/dish/:num`.
  
  * We render the `dish` template by passing it in as an argument. Then we use params to select the correct dish to render in the template, based on the index of the object. Now we have access to a dish description through a dish object, as follows:

    ```js
    router.get('/dish/:num', async (req, res) => {
      return res.render('dish', dishes[req.params.num - 1]);
    });
    ```

* Open `04-Stu_Handlebars-Expressions/Solved/views/dish.handlebars` in your IDE and explain the following:

  * üîë We create a Handlebars.js expression, `{{ description }}`, passing in the `description` key name like in the following example:

    ```html
      <div class="card-body">
        <p>
          Description:
          {{description}}
        </p>
      </div>
    ```

* Run `npm install` and `npm start` from the command line.

* Navigate to <http://local:host3001/dish/1> and demonstrate the following:

  * Now, when we view the page for one dish, we see the name of that dish and the dish description.

* Ask the class the following questions (‚òùÔ∏è) and call on students for the answers (üôã):

  * ‚òùÔ∏è What is the syntax for a Handlebars.js expression?

  * üôã `{{ data }}`

  * ‚òùÔ∏è How do we render data using a Handlebars.js expression?

  * üôã Inside the curly brackets, we insert the key name of the value we wish to render.

  * ‚òùÔ∏è How does this relate to MVC?

  * üôã The Controller passes data to the View via a route, and the View renders that data in the browser.

  * ‚òùÔ∏è What can we do if we don't completely understand this?

  * üôã We can refer to supplemental material, read the [Handlebars.js documentation on expressions](https://handlebarsjs.com/guide/expressions.html), and stick around for office hours to ask for help.

* Answer any questions before proceeding to the next activity.

### 8. Instructor Demo: Built-In Helpers (5 min)

* Open `05-Ins_Built-In-Helpers/controllers/dish-routes.js` in your IDE and explain the following:

  * Now that `dishes` is hardcoded into `dish-routes.js`, we pass it in as an argument to `render()`, like in the following example:

    ```js
    router.get('/', async (req, res) => {
      res.render('all', { dishes });
    });
    ```

  * üîë We can use built-in Handlebars.js helpers to conditionally render blocks of code, iterate over lists, and more. Because the Controller is passing `dishes` to the View through `render()`, we can use a built-in helper to iterate over it in the template.

* Open `05-Ins_Built-In-Helpers/views/all.handlebars` in your IDE and demonstrate the following:

  * üîë In `all.handlebars`, we are using `#each` to iterate over and render a menu for the dish data.

  * In this case, `dishes` represents the array of dish objects that the Controller passed to the template. `dish` represents one dish object in that array.

  * üîë `{{#each dishes as |dish|}}` is followed by the block of code to be rendered for each dish object. We could also use the syntax `{{#each dish}}` and then use `this.id` and `this.dish_name` in the block of code.
  
  * üîë Then we close the `#each` helper with `{{/each}}`, as follows:

    ```html
      {{#each dishes as |dish|}}
        <div class="dish col-md-5">
          <p>
            {{dish.id}}.
            {{dish.dish_name}}
          </p>
        </div>
        <div class="col-md-7">
          <p>
            <!-- guest_name will eventually go here -->
          </p>
        </div>
      {{/each}}
    ```

* Run `npm install` and `npm start` from the command line.

* Navigate to <http://localhost:3001/> in your browser and demonstrate the following:

  * Here we see that each dish name is successfully rendered on the menu card.

* Ask the class the following questions (‚òùÔ∏è) and call on students for the answers (üôã):

  * ‚òùÔ∏è When should we use built-in helpers?

  * üôã If we need to iterate over data or conditionally render blocks of code.

  * ‚òùÔ∏è Where would we include built-in helpers?

  * üôã We can include built-in helpers in Handlebars.js templates.

* Answer any questions before proceeding to the next activity.

* In preparation for the activity, ask TAs to start directing students to the activity instructions found in `06-Stu_Built-In-Helpers/README.md`.

### 9. Student Do: Built-In Helpers (15 min)

* Direct students to the activity instructions found in `06-Stu_Built-In-Helpers/README.md`.

* Break your students into pairs that will work together on this activity.

  ```md
  # üìñ Conditionally Render Food Allergens

  Work with a partner to implement the following user story:

  * As a party guest, I want to know whether a food item contains nuts.

  ## Acceptance Criteria

  * It's done when the View displays the message "Contains Nuts" under the food items that contain nuts.

  ## üìù Notes

  Refer to the documentation: 

  [Handlebars.js documentation on built-in helpers](https://handlebarsjs.com/guide/builtin-helpers.html#if)

  ## üí° Hints

  Which built-in helper conditionally renders a block?

  ## üèÜ Bonus

  If you have completed this activity, work through the following challenge with your partner to further your knowledge:

  * Which built-in helper method is the inverse of `#if`? What is a use case for rendering a block if an expression is a falsy value? 

  Use [Google](https://www.google.com) or another search engine to research this.
  ```

* While breaking everyone into groups, be sure to remind students and the rest of the instructional staff that questions on Slack or otherwise are welcome and will be handled. It's a good way for your team to prioritize students who need extra help.

### 10. BREAK (15 min)

### 11. Instructor Review: Built-In Helpers (10 min)

* Ask the class the following questions (‚òùÔ∏è) and call on students for the answers (üôã):

  * ‚òùÔ∏è How comfortable do you feel with built-in helpers? (Poll via Fist to Five, Slack, or Zoom)

* Assure students that we will cover the solution to help solidify their understanding. If questions remain, remind them to use office hours to get extra help!

* Use the prompts and talking points (üîë) below to review the following key points:

  * ‚úîÔ∏è `#if`

* Open `06_Stu-Built-in-Helpers/Solved/controllers/dish-routes.js` in your IDE and explain the following:

  * The dish data includes a Boolean (`has_nuts`) that is set to `true` for the dishes that contain nuts, as shown in the following example:

    ```js
        {
          id: 2,
          dish_name: 'Cheese Plate with Spanish Chorizo',
          description: 'Manchego, Iberico, Cabrales, fig jam, grapes, pecans, and Spanich Chorizo',
          has_nuts: true,
        },
    ```

* Open `06-Stu_Built-In-Helpers/Solved/views/dish.handlebars` in your IDE and explain the following:

  * üîë We want to make sure that the message "Contains Nuts" is only rendered for dish objects that actually contain nuts. To do this, we need to conditionally render a block of code with the built-in `#if` helper.

  * üîë We provide `has_nuts` as the condition when we open the `#if` helper. Then we include the block of code that we want to conditionally render. Finally, we close `#if`, as follows:

    ```html
      {{#if has_nuts}}
        <p class="has-nuts">
          Contains Nuts
        </p>
      {{/if}}
    ```

* Run `npm install` and `npm start` from the command line.

* Navigate to <http://local:host3001/dish/2> in your browser and demonstrate the following:

  * The message "Contains Nuts" shows up when a dish contains nuts!

* Navigate to <http://local:host3001/dish/1> in your browser and demonstrate the following:

  * The message is not being rendered here, because the dish does not contain nuts.

* Ask the class the following questions (‚òùÔ∏è) and call on students for the answers (üôã):

  * ‚òùÔ∏è When is it a good idea to use a Handlebars.js built-in helper?

  * üôã We might want to use built-in helpers when we need to iterate over a list, conditionally render a block of code, and so on.

  * ‚òùÔ∏è How do built-in helpers relate to MVC?

  * üôã Built-in helpers relate to the View in the MVC framework because they aid an application in displaying the right data to the user at the right time.

  * ‚òùÔ∏è What can we do if we don't completely understand this?

  * üôã We can refer to supplemental material, read the [Handlebars.js documentation on built-in helpers](https://handlebarsjs.com/guide/builtin-helpers.html#each), and stick around for office hours to ask for help.

* Answer any questions before proceeding to the next activity.

### 12. Instructor Demo: Data Serialization (5 min)

* Rename the `07-Ins_Data-Serialization/.env.EXAMPLE` file to `.env` and input your credentials.

* Run `node seeds/index.js` from the command line and explain the following:

  * üîë Now we will move on to using Sequelize and MySQL. So far, we've focused on the Controller and the View. Now that we have a seeded database, we can look at how the Model fits into the MVC framework.

* Open `07-Ins_Data-Serialization/views/dish.handlebars` in your IDE and demonstrate the following:

  * Nothing has changed in the View. We are still using Handlebars.js expressions and built-in helpers to render data that is passed in.

* Open `07-Ins_Data-Serialization/controllers/dish-routes.js` in your IDE and demonstrate the following:

  * For the purpose of this demo, the Controller includes two GET routes for one dish. The first does not serialize data; the second one (currently commented out) does serialize the data.

  * üîë With the Model set up, the Controller has changed. Now we are using `findByPk()` to locate a dish in the database. Once `dishData` is found, we pass it to the `dish` template in the View to be rendered, as shown in the following example:

    ```js
    // get one dish without serializing data
    router.get('/dish/:id', async (req, res) => {
      try {
        const dishData = await Dish.findByPk(req.params.id);
        console.log(dishData)
        res.render('dish', dishData);
      } catch (err) {
        res.status(500).json(err);
      }
    });
    ```

* Run `npm install` and `npm start`, navigate to <http://local:host3001/dish/1> in your browser, and demonstrate the following:

  * üîë The object will be returned as a Sequelize object, which can be difficult to parse through on the template side.

  * üîë When we check the browser, the template is there, but the data is missing.

  * üîë When we check the command prompt, we see that we are logging the Sequelize object. Look at all of the extra data in the following code:

    ```js
      dish {
      dataValues: {
        id: 2,
        dish_name: 'Fish Tacos',
        description: 'Battered/fried fish, corn tortillas, fresh slaw with jalepenos and cilantro, pickled red onion',
        guest_name: 'Carlos',
        has_nuts: false,
        createdAt: 2020-11-17T22:33:06.000Z,
        updatedAt: 2020-11-17T22:33:06.000Z
      },
      _previousDataValues: {
        id: 2,
        dish_name: 'Fish Tacos',
        description: 'Battered/fried fish, corn tortillas, fresh slaw with jalepenos and cilantro, pickled red onion',
        guest_name: 'Carlos',
        has_nuts: false,
        createdAt: 2020-11-17T22:33:06.000Z,
        updatedAt: 2020-11-17T22:33:06.000Z
      },
      _changed: {},
      _modelOptions: {
        timestamps: true,
        validate: {},
        freezeTableName: true,
        underscored: true,
        paranoid: false,
        rejectOnEmpty: false,
        whereCollection: { id: '2' },
        schema: null,
        schemaDelimiter: '',
        defaultScope: {},
        scopes: {},
        indexes: [],
        name: { plural: 'dishes', singular: 'dish' },
        omitNull: false,
        sequelize: Sequelize {
          options: [Object],
          config: [Object],
          dialect: [MysqlDialect],
          queryInterface: [QueryInterface],
          models: [Object],
          modelManager: [ModelManager],
          connectionManager: [ConnectionManager],
          importCache: {}
        },
        hooks: {}
      },
      _options: {
        isNewRecord: false,
        _schema: null,
        _schemaDelimiter: '',
        raw: true,
        attributes: [
          'id',
          'dish_name',
          'description',
          'guest_name',
          'has_nuts',
          'createdAt',
          'updatedAt'
        ]
      },
      isNewRecord: false
    }
    ```

  * üîë So the Controller must **serialize** the data in the route to get rid of all of that extra information, before passing it to the templates in the View.

* In `07-Ins_Data-Serialization/controllers/dish-routes.js`, comment out the first GET route and uncomment the second GET route to demonstrate the following:

  * üîë The second GET route in the Controller is serializing the Sequalize object.

  * üîë We accomplish this by attaching `.get({ plain: true })` to the returned object `dishData`. Then we pass the serialized data as `dish` through to the `'dish'` template, like in the following example:

    ```js
      // get one dish with serialized data
      router.get('/dish/:id', async (req, res) => {
        try {
          const dishData = await Dish.findByPk(req.params.id);
          const dish = dishData.get({ plain: true });
          res.render('dish', dish);
        } catch (err) {
          res.status(500).json(err);
        }
      });
    ```

* Restart your server, navigate to <http://local:host3001/dish/1> in your browser, and demonstrate the following:.

  * The View for one dish is now rendering both the template and the data.

* Ask the class the following questions (‚òùÔ∏è) and call on students for the answers (üôã):

  * ‚òùÔ∏è How would we ensure that the templates in the View can parse the data sent by the Controller?

  * üôã We serialize the data in the Controller so that we only send the necessary data to the View.

* Answer any questions before proceeding to the next activity.

* In preparation for the activity, ask TAs to start directing students to the activity instructions found in `08-Stu_Data-Serialization/README.md`.

### 13. Student Do: Data Serialization (15 min)

* Direct students to the activity instructions found in `08-Stu_Data-Serialization/README.md`.

* Break your students into pairs that will work together on this activity.

* Remind students to set up their `dish_db` database and seed it before starting on the activity.

  > **Important**: Students should also modify the `.env.EXAMPLE` file to include their MySQL user and password information and run `npm install` before every subsequent activity.

  ```md
  # üêõ Main View Is Not Displaying Food Items 

  Work with a partner to resolve the following issue(s):

  * As a party guest, I would like to view a full menu of food items that other guests will bring to the party.

  ## Expected Behavior

  * When a party guest views the page, they see a menu of food items.

  ## Actual Behavior

  * When a party guest views the page, no food items appear on the menu.

  ## Steps to Reproduce the Problem

  1. Run `npm install`. 

  2. Confirm that the MySQL server is turned on.

  3. Run `CREATE DATABASE dish_db;` to create a new database.

  4. Return to your console and run `node seeds/index.js` to seed the database.

  5. Run `npm start`.

  6. Navigate to <http://localhost:3001/> in your browser.

  ## Assets

  The following image demonstrates the web application's appearance and functionality:

  ![The "Potluck Party!" webpage displays a list of dishes and the name of the guest who will bring each one.](images/Full-Menu.png)

  ---

  ## üí° Hints

  How can you change your route so that the View will display the menu?

  ## üèÜ Bonus

  If you have completed this activity, work through the following challenge with your partner to further your knowledge:

  * How else could you serialize data down to the properties that you need? 

  Use [Google](https://www.google.com) or another search engine to research this.
  ```

* While breaking everyone into groups, be sure to remind students and the rest of the instructional staff that questions on Slack or otherwise are welcome and will be handled. It's a good way for your team to prioritize students who need extra help.

### 14. Instructor Review: Data Serialization (10 min)

* Ask the class the following questions (‚òùÔ∏è) and call on students for the answers (üôã):

  * ‚òùÔ∏è How comfortable do you feel with data serialization? (Poll via Fist to Five, Slack, or Zoom)

* Assure students that we will cover the solution to help solidify their understanding. If questions remain, remind them to use office hours to get extra help!

* Use the prompts and talking points (üîë) below to review the following key points:

  * ‚úîÔ∏è `map()`

  * ‚úîÔ∏è Data serialization

* Open `08-Stu_Data-Serialization/Solved/controllers/dish-routes.js` in your IDE and explain the following:

  * To render a full menu for party guests, using a GET route, we must first query the database for all dish objects by using the Sequelize method `findAll()`.

  * üîë Instead of receiving one object, we receive an array of dish objects that need to be serialized before being rendered. We use `map()` to return a new array of serialized objects by adding `.get({ plain: true})` to each `dish` object.

  * Finally, the Controller sends the newly serialized array of dishes to the `'all'` template in the View, as follows:

    ```js
    router.get('/', async (req, res) => {
      const dishData = await Dish.findAll().catch((err) => { 
        res.json(err);
       }); 
      const dishes = dishData.map((dish) => dish.get({ plain: true }));
      res.render('all', { dishes });
    });
    ```

  * Run `npm install` and `npm start` from the command line, then navigate to <http://localhost:3001/> in your browser.

  * The View is rendering a full menu of dishes, as expected.

* Ask the class the following questions (‚òùÔ∏è) and call on students for the answers (üôã):

  * ‚òùÔ∏è Why do we need to serialize data in the Controller?

  * üôã Sequelize objects include extra data that the View does not need. We serialize data in the Controller so that the templates in the View can parse and render the data from the Model.

  * ‚òùÔ∏è What can we do if we don't completely understand this?

  * üôã We can refer to supplemental material, read the [Sequelize documentation on Models](https://sequelize.org/master/class/lib/model.js~Model.html), and stick around for office hours to ask for help.

* Answer any questions before proceeding to the next activity.

### 15. Instructor Demo: Handlebars.js Front-End Logic (5 min)

* Rename the `09-Ins_Handlebars-FE-Logic/.env.EXAMPLE` file to `.env` and input your credentials.

* üîë The MVC framework follows the **separation of concerns principle**. This means keeping content separate from presentation and keeping data processing separate from content. This principle helps us write clear and maintainable code.

* üîë To explore MVC and the separation of concerns principle further, now let's examine a form that allows users to add a dish to the database.

* Open `09-Ins_Handlebars-FE-Logic/views/all.handlebars` in your IDE and demonstrate the following:

  * This RSVP form to the `'all'` template allows guests to provide information about the dish they plan to bring to the party.

  * üîë To add an event listener, we need to connect the template in `'all'` to the JS in `add-dish.js` by adding a `<script>` tag, as follows:

    ```handlebars
      <script src="/js/add-dish.js"></script>
    ```

* Open `09-Ins_Handlebars-FE-Logic/public/js/add-dish.js` in your IDE and demonstrate the following:

  * üîë Because the template is connected to the JS in the `public` folder, we can add an event listener for the form in `add-dish.js`.

  * On submit, the form handler will capture user input from the form fields in the View, as shown in the following example:

    ```js
      document.querySelector('.new-dish-form').addEventListener('submit', newFormHandler);
    ```

  * Notice the syntax where `has_nuts` is declared, shown in the following example:

    ```js
    const has_nuts = document.querySelector('#has_nuts:checked') ? true : false;
    ```

    This is a **ternary operator**, or another type of conditional operator. `'#has_nuts:checked'` is the condition, followed by a `?`. If it is truthy, `has-nuts` will be true. Otherwise, it will be false.

  * üîë Using the POST method, `fetch()` passes the form input to the Controller in the body of the request, as follows:

    ```js
     const response = await fetch(`/api/dish`, {
       method: 'POST',
       body: JSON.stringify({
        dish_name,
        description,
        guest_name,
        has_nuts,
       }),
       headers: {
        'Content-Type': 'application/json',
      },
     });
    ```

* Open `09-Ins_Handlebars-FE-Logic/controllers/api/dish-routes.js` in your IDE and demonstrate the following:

  * üîë The POST route in the Controller accepts the input, uses the Model to create a dish object in the database, and then returns the data. See the following code for an example:

    ```js
     router.post('/', async (req, res) => {
       try { 
         const dishData = await Dish.create({
           dish_name: req.body.dish_name,
           description: req.body.description,
           guest_name: req.body.guest_name,
           has_nuts: req.body.has_nuts,
         });
        res.status(200).json(dishData)
        } catch (err) {
          res.status(400).json(err);
        }
      });
    ```

  * üîë When the dish is added and a successful response is sent to `add-dish.js`, the `all` template is re-rendered by the View.

* Run `npm install` and `npm start` from the command line.

* Navigate to <http://localhost:3001/> in your browser and demonstrate the following:

  * Now when we add information into the form and click Submit, we can see that the dish has been added to the menu.

* Ask the class the following questions (‚òùÔ∏è) and call on students for the answers (üôã):

  * ‚òùÔ∏è How do we process user input and send it to the Controller?

  * üôã We can use a form handler to collect form input and send it to the Controller, where the business logic will be performed.

  * ‚òùÔ∏è How do we connect the form handlers in the `js` folder to the templates in the View?

  * üôã We can add a `<script>` tag with `src="<our-file-name>"` at the bottom of the template.

* Answer any questions before proceeding to the next activity.

* In preparation for the activity, ask TAs to start directing students to the activity instructions found in `10-Stu_Handlebars-FE-Logic/README.md`.

### 16. Student Do: Handlebars.js Front-End Logic (15 min)

* Direct students to the activity instructions found in `10-Stu_Handlebars-FE-Logic/README.md`.

* Break your students into pairs that will work together on this activity.

  ```md
  # üìê Add Comments to the Implementation of a Form to Update a Food Item

  Work with a partner to add comments describing the functionality of the code found in [dish.handlebars](./Unsolved/views/dish.handlebars), [edit-dish](./Unsolved/public/js/edit-dish.js), and [dish-routes](./Unsolved/controllers/api/dish-routes.js).

  ## üìù Notes

  Refer to the documentation: 

  [Handlebars.js documentation](https://handlebarsjs.com/guide/#what-is-handlebars)

  [MDN Web Docs on MVC](https://developer.mozilla.org/en-US/docs/Glossary/MVC)

  ---

  ## üèÜ Bonus

  If you have completed this activity, work through the following challenge with your partner to further your knowledge:

  * What are the pros and cons of using a template engine like Handlebars.js?

  Use [Google](https://www.google.com) or another search engine to research this.
  ```

* While breaking everyone into groups, be sure to remind students and the rest of the instructional staff that questions on Slack or otherwise are welcome and will be handled. It's a good way for your team to prioritize students who need extra help.

### 17. Instructor Review: Handlebars.js Front-End Logic (15 min)

* Ask the class the following questions (‚òùÔ∏è) and call on students for the answers (üôã):

  * ‚òùÔ∏è How comfortable do you feel with MVC and front-end logic? (Poll via Fist to Five, Slack, or Zoom)

* Assure students that we will cover the solution to help solidify their understanding. If questions remain, remind them to use office hours to get extra help!

* Use the prompts and talking points (üîë) below to review the following key points:

  * ‚úîÔ∏è View

  * ‚úîÔ∏è Model

  * ‚úîÔ∏è Controller

  * ‚úîÔ∏è Front-end logic

  * ‚úîÔ∏è Ternary operator

* Open `10-Stu_Handlebars-FE-Logic/Solved/views/dish.handlebars` in your IDE and explain the following:

  * We now have an edit form in the `'dish'` template that allows users to update a dish.

  * üîë As a part of the View, this form is responsible for the UI/UX logic. It is not responsible for business or data-related logic.

* Open `10-Stu_Handlebars-FE-Logic/Solved/public/js/edit-dish.js` in your IDE and explain the following:

  * We've added an event listener to the form in `edit-dish.js`.

  * üîë On submit, the form handler will capture user input from the form fields in the View and process the data using front-end logic to pass to the Controller, as follows:

    ```js
    document.querySelector('.edit-dish-form').addEventListener('submit', editFormHandler);
    ```

  * üîë We've included a ternary operator again, shown in the following example, to indicate whether the checkbox for "Contains Nuts" has been checked or not:

    ```js
    const has_nuts = document.querySelector('#has_nuts:checked') ? true : false;
    ```

  * We are using the URL to access the dish's id, as follows, to ensure that we send the fetch request to the correct endpoint:

    ```js
    const id = window.location.toString().split('/')[
      window.location.toString().split('/').length - 1
    ];
    ```

  * üîë `fetch()` passes the edit form input to the Controller in the body of the request with the PUT method, like in the following example:

    ```js
     const response = await fetch(`/api/dish/${id}`, {
       method: 'PUT',
       body: JSON.stringify({
        dish_name,
        description,
        guest_name,
        has_nuts,
       }),
       headers: {
        'Content-Type': 'application/json',
      },
     });
    ```

* Open `10-Stu_Handlebars-FE-Logic/controllers/api/dish-routes.js` in your IDE and demonstrate the following:

  * üîë The PUT route in the Controller accepts the input, uses the Model to edit a dish object in the database, and then returns a response to `edit-dish.js`. If the response to the following code is OK, `dish` will be rendered by the View:

    ```js
      router.put('/:id', async (req, res) => {
      try {
        const dish = await Dish.update(
          {
            dish_name: req.body.dish_name,
            description: req.body.description,
            guest_name: req.body.guest_name,
            has_nuts: req.body.has_nuts,
          },
          {
            where: {
            id: req.params.id,
          },
          });
          res.status(200).json(dish);
        } catch (err) {
          res.status(500).json(err);
        };
      });
    ```
  
* Run `npm install` and `npm start` from the command line.

* Navigate to <http://localhost:3001/> in your browser and demonstrate the following:

  * Now when we add information into the form to edit a dish and click Submit, we can see that the dish info has been edited.

* Ask the class the following questions (‚òùÔ∏è) and call on students for the answers (üôã):

  * ‚òùÔ∏è What is the separation of concerns principle, and why is it important?

  * üôã The separation of concerns principle calls for content to be kept separate from presentation and for data processing to be kept separate from content. This helps us write conventional, clear, and maintainable code.

  * ‚òùÔ∏è What can we do if we don't completely understand this?

  * üôã We can refer to supplemental material, read the [MDN Web Docs on MVC](https://developer.mozilla.org/en-US/docs/Glossary/MVC), and stick around for office hours to ask for help.

* Answer any questions before ending the class.

### 18. END (0 min)

How did today‚Äôs lesson go? Your feedback is important. Please take 5 minutes to complete this [anonymous survey](https://forms.gle/RfcVyXiMmZQut6aJ6).

---
¬© 2022 edX Boot Camps LLC. Confidential and Proprietary. All Rights Reserved.
